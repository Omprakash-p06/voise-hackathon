<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FetoSense - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container-fluid">
            <div class="d-flex align-items-center justify-content-between" style="width: 100%;">
                <a href="index.html" class="navbar-brand">
                    <span>ü§∞</span>
                    <span>FetoSense</span>
                </a>
                <div class="d-flex gap-1">
                    <a href="index.html" class="nav-link">Dashboard</a>
                    <a href="patients.html" class="nav-link">Patients</a>
                    <a href="add-patient.html" class="nav-link">Add Patient</a>
                    <a href="analytics.html" class="nav-link">Analytics</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">Maternal Health Monitoring System for ASHA Workers</p>
            <p class="text-muted" style="font-size: 0.875rem; margin-top: 4px;">
                <strong>Today:</strong> <span id="currentDate"></span> |
                Risk assessment based on WHO & PMSMA guidelines
            </p>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon primary">
                    <span>üë•</span>
                </div>
                <div class="metric-value" id="totalPatients">0</div>
                <div class="metric-label">Total Patients</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon danger">
                    <span>‚ö†Ô∏è</span>
                </div>
                <div class="metric-value" id="highRiskCount">0</div>
                <div class="metric-label">High Risk Patients</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon warning">
                    <span>üìÖ</span>
                </div>
                <div class="metric-value" id="overdueCount">0</div>
                <div class="metric-label">Overdue Follow-ups</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon success">
                    <span>‚úÖ</span>
                </div>
                <div class="metric-value" id="scheduledCount">0</div>
                <div class="metric-label">Scheduled This Week</div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div id="alertsSection"></div>

        <!-- Recent Patients -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="card-title">Recent Patients</h2>
                    <a href="patients.html" class="btn btn-outline btn-sm">View All Patients ‚Üí</a>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Village</th>
                                <th>Age</th>
                                <th>Last Visit</th>
                                <th>Risk Level</th>
                                <th>Next Follow-up</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="recentPatientsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Quick Actions</h2>
            </div>
            <div class="card-body">
                <div class="d-flex gap-2" style="flex-wrap: wrap;">
                    <a href="add-patient.html" class="btn btn-primary">
                        <span>‚ûï</span>
                        <span>Add New Patient</span>
                    </a>
                    <a href="patients.html?filter=high" class="btn btn-danger">
                        <span>‚ö†Ô∏è</span>
                        <span>View High Risk Patients</span>
                    </a>
                    <a href="patients.html?filter=overdue" class="btn btn-warning">
                        <span>üìÖ</span>
                        <span>View Overdue Follow-ups</span>
                    </a>
                    <a href="analytics.html" class="btn btn-secondary">
                        <span>üìä</span>
                        <span>View Analytics</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Dashboard-specific JavaScript
        function loadDashboard() {
            const patients = FetoSense.getPatients();

            // Update current date
            document.getElementById('currentDate').textContent = Utils.formatDateLong(FetoSense.getCurrentDate());

            // Calculate metrics
            let highRiskCount = 0;
            let overdueCount = 0;
            let scheduledThisWeek = 0;

            const today = new Date(FetoSense.getCurrentDate());
            const weekFromNow = new Date(today);
            weekFromNow.setDate(weekFromNow.getDate() + 7);

            patients.forEach(patient => {
                const score = RiskCalculator.calculateScore(patient);
                const category = RiskCalculator.getCategory(score);
                const followupDate = RiskCalculator.getNextFollowupDate(patient);
                const status = RiskCalculator.getFollowupStatus(followupDate);

                if (category === 'HIGH') highRiskCount++;
                if (status === 'OVERDUE') overdueCount++;

                const followup = new Date(followupDate);
                if (followup >= today && followup <= weekFromNow) {
                    scheduledThisWeek++;
                }
            });

            // Update metrics
            document.getElementById('totalPatients').textContent = patients.length;
            document.getElementById('highRiskCount').textContent = highRiskCount;
            document.getElementById('overdueCount').textContent = overdueCount;
            document.getElementById('scheduledCount').textContent = scheduledThisWeek;

            // Show alerts if needed
            const alertsSection = document.getElementById('alertsSection');
            alertsSection.innerHTML = '';

            if (highRiskCount > 0) {
                alertsSection.innerHTML += `
                    <div class="alert alert-danger">
                        <strong>‚ö†Ô∏è Attention Required:</strong> You have ${highRiskCount} high-risk patient${highRiskCount > 1 ? 's' : ''} requiring immediate attention.
                        <a href="patients.html?filter=high" style="color: inherit; text-decoration: underline; margin-left: 8px;">View Now ‚Üí</a>
                    </div>
                `;
            }

            if (overdueCount > 0) {
                alertsSection.innerHTML += `
                    <div class="alert alert-warning">
                        <strong>üìÖ Overdue Follow-ups:</strong> ${overdueCount} patient${overdueCount > 1 ? 's have' : ' has'} missed their follow-up appointment${overdueCount > 1 ? 's' : ''}.
                        <a href="patients.html?filter=overdue" style="color: inherit; text-decoration: underline; margin-left: 8px;">View Now ‚Üí</a>
                    </div>
                `;
            }

            // Load recent patients (sorted by last visit date)
            const sortedPatients = [...patients].sort((a, b) => {
                const dateA = new Date(a.visits[a.visits.length - 1].date);
                const dateB = new Date(b.visits[b.visits.length - 1].date);
                return dateB - dateA;
            });

            const recentPatients = sortedPatients.slice(0, 5);
            const tbody = document.getElementById('recentPatientsTable');
            tbody.innerHTML = '';

            recentPatients.forEach(patient => {
                const latestVisit = patient.visits[patient.visits.length - 1];
                const score = RiskCalculator.calculateScore(patient);
                const category = RiskCalculator.getCategory(score);
                const followupDate = RiskCalculator.getNextFollowupDate(patient);
                const status = RiskCalculator.getFollowupStatus(followupDate);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${patient.name}</strong></td>
                    <td>${patient.village}</td>
                    <td>${patient.age}</td>
                    <td>${Utils.formatDate(latestVisit.date)}</td>
                    <td><span class="badge badge-${category.toLowerCase()}">${category}</span></td>
                    <td>${Utils.formatDate(followupDate)}</td>
                    <td><span class="badge badge-${status.toLowerCase()}">${status}</span></td>
                    <td>
                        <a href="patient-details.html?id=${patient.id}" class="btn btn-primary btn-sm">View</a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>

</html>